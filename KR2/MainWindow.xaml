<?xml version="1.0" encoding="utf-8"?>
<Window x:Class="FlowSensor.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
        Title="Flow Sensor Tracking" Height="800" Width="1602" MinHeight="600" MinWidth="1024"
        SizeToContent="Manual">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="513*"/>
            <ColumnDefinition Width="199*"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Верхняя панель -->
        <DockPanel LastChildFill="False" Margin="10,10,10,10" Grid.Row="0" Grid.ColumnSpan="2">
            <Button x:Name="StartParalSimulationButton" Content="Параллельный запуск" Width="141" Margin="5" Click="StartParalSimulationButton_Click"/>
            <Button x:Name="StartVariableParalSimulationButton" Content="Параллельный запуск по переменной" Width="230" Margin="5" Click="StartVariableParalSimulationButton_Click"/>
            <Button x:Name="StartSimulationButton" Content="Запуск" Width="95" Margin="5" Click="StartSimulationButton_Click"/>
            <Button x:Name="PauseSimulationButton" Content="Пауза" Width="88" Margin="5" Click="PauseSimulationButton_Click"/>
            <Button x:Name="ResetSimulationButton" Content="Сброс" Width="87" Margin="5" Click="ResetSimulationButton_Click"/>
            <Button x:Name="SaveParamsButton" Content="Сохранить параметры" Width="150" Margin="5" Click="SaveParamsButton_Click"/>
            <Button x:Name="LoadParamsButton" Content="Загрузить параметры" Width="151" Margin="5" Click="LoadParamsButton_Click"/>
            <Button x:Name="ResetParamsButton" Content="Сбросить параметры" Width="150" Margin="5" Click="ResetParamsButton_Click"/>
            <Button x:Name="SaveResultsButton" Content="Сохранить результаты" Width="152" Margin="5" Click="SaveResultsButton_Click"/>
            <Button x:Name="LoadResultsButton" Content="Загрузить результаты" Width="150" Margin="5" Click="LoadResultsButton_Click"/>
            <Button x:Name="ClearResultsButton" Content="Очистить результаты" Width="150" Margin="5" Click="ClearResultsButton_Click"/>

        </DockPanel>

        <!-- Основная область -->
        <Grid Grid.Row="1" Margin="10,10,10,10" Grid.ColumnSpan="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="250"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="300"/>
            </Grid.ColumnDefinitions>

            <!-- Левая панель с полями ввода параметров -->
            <StackPanel Grid.Column="0" Margin="5">
                <TextBlock Text="Параметры области" FontWeight="Bold"/>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <TextBlock Text="Время моделирования:" Grid.Column="0" Margin="5"/>
                    <TextBox x:Name="SimulationTimeInput" Grid.Column="1" Margin="5" Text="50"/>
                </Grid>

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <TextBlock Text="Тип области:" Grid.Column="0" Margin="5"/>
                    <ComboBox x:Name="BoundTypeComboBox" Grid.Column="1" Margin="5" SelectionChanged="ShapeComboBox_SelectionChanged" SelectedIndex="0">
                        <ComboBoxItem x:Name="Round" Content="Круглая"/>
                        <ComboBoxItem x:Name="Square" Content="Прямоугольная"/>
                        <ComboBoxItem x:Name="Polygon" Content="Многоугольная"/>
                    </ComboBox>
                </Grid>

                <!-- StackPanel для параметров круга -->
                <StackPanel x:Name="circlePanel" Margin="0,10,0,0">
                    <TextBlock Text="Параметры круглой области" FontWeight="Bold"/>
                    <Grid Margin="5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Text="X:" Grid.Row="0" Grid.Column="0" Margin="0,0,5,5"/>
                        <TextBox x:Name="circleCenterX" Grid.Row="0" Grid.Column="1" Margin="0,0,0,5"/>

                        <TextBlock Text="Y:" Grid.Row="1" Grid.Column="0" Margin="0,0,5,5"/>
                        <TextBox x:Name="circleCenterY" Grid.Row="1" Grid.Column="1" Margin="0,0,0,5"/>

                        <TextBlock Text="Радиус:" Grid.Row="2" Grid.Column="0" Margin="0,0,5,0"/>
                        <TextBox x:Name="circleRadius" Grid.Row="2" Grid.Column="1"/>
                    </Grid>
                </StackPanel>

                <!-- StackPanel для параметров прямоугольника -->
                <StackPanel x:Name="rectanglePanel" Margin="0,10,0,0" Visibility="Collapsed">
                    <TextBlock Text="Параметры прямоугольной области" FontWeight="Bold"/>
                    <Grid Margin="5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Text="X:" Grid.Row="0" Grid.Column="0" Margin="0,0,5,5"/>
                        <TextBox x:Name="rectCenterX" Grid.Row="0" Grid.Column="1" Margin="0,0,0,5"/>

                        <TextBlock Text="Y:" Grid.Row="1" Grid.Column="0" Margin="0,0,5,5"/>
                        <TextBox x:Name="rectCenterY" Grid.Row="1" Grid.Column="1" Margin="0,0,0,5"/>

                        <TextBlock Text="Ширина:" Grid.Row="2" Grid.Column="0" Margin="0,0,5,5"/>
                        <TextBox x:Name="rectWidth" Grid.Row="2" Grid.Column="1" Margin="0,0,0,5"/>

                        <TextBlock Text="Высота:" Grid.Row="3" Grid.Column="0" Margin="0,0,5,0"/>
                        <TextBox x:Name="rectHeight" Grid.Row="3" Grid.Column="1"/>
                    </Grid>
                </StackPanel>

                <!-- StackPanel для параметров многоугольника -->
                <StackPanel x:Name="polygonPanel" Margin="0,10,0,0" Visibility="Collapsed">
                    <TextBlock Text="Параметры многоугольной области" FontWeight="Bold"/>
                    <StackPanel x:Name="pointsContainer" Margin="0,5,0,0">
                        <!-- Точки будут добавляться динамически -->
                    </StackPanel>
                    <Button x:Name="addPointButton" Content="Добавить точку" Margin="0,5,0,0" Click="AddPointButton_Click"/>
                </StackPanel>
                <StackPanel x:Name="probabilityParametersInput" Margin="0,10,0,0" Visibility="Visible">
                    <TextBlock Text="Параметры распределения вероятностей" FontWeight="Bold"/>
                    <Grid Margin="5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Text="Vmax:" Grid.Row="0" Grid.Column="0" Margin="0,0,5,5"/>
                        <TextBox x:Name="VmaxInput" Grid.Row="0" Grid.Column="1" Margin="0,0,0,5"/>

                        <TextBlock Text="Tmax:" Grid.Row="1" Grid.Column="0" Margin="0,0,5,5"/>
                        <TextBox x:Name="TmaxInput" Grid.Row="1" Grid.Column="1" Margin="0,0,0,5"/>

                        <TextBlock x:Name ="OmaxText" Text="Omax:" Grid.Row="2" Grid.Column="0" Margin="0,0,5,0" Visibility="Collapsed"/>
                        <TextBox x:Name="OmaxInput" Grid.Row="2" Grid.Column="1" Visibility="Collapsed"/>
                    </Grid>
                </StackPanel>
                <StackPanel>
                    <TextBlock Text="Параметры движения точек" FontWeight="Bold"/>
                    <Grid Margin="5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Text="Количество:" Grid.Row="0" Grid.Column="0" Margin="0,0,5,5"/>
                        <TextBox x:Name="PointsCountInput" Grid.Row="0" Grid.Column="1" Margin="0,0,0,5"/>

                        <TextBlock Text="Тип движения:" Grid.Row="1" Grid.Column="0" Margin="0,0,5,5"/>
                        <ComboBox x:Name="PointTypeComboBox" Grid.Row="1" Grid.Column="1" Margin="0,0,5,5" SelectedIndex="0">
                            <ComboBoxItem Content="Статическое"/>
                            <ComboBoxItem Content="Динамическое"/>
                        </ComboBox>

                        <TextBlock Text="vmax:" Grid.Row="2" Grid.Column="0" Margin="0,0,5,5"/>
                        <TextBox x:Name="vmaxInput" Grid.Row="2" Grid.Column="1" Margin="0,0,0,5"/>

                        <TextBlock Text="tmax:" Grid.Row="3" Grid.Column="0" Margin="0,0,5,5"/>
                        <TextBox x:Name="tmaxInput" Grid.Row="3" Grid.Column="1" Margin="0,0,0,5"/>
                    </Grid>
                </StackPanel>
                <StackPanel>
                    <TextBlock Text="Параметры видимости точек" FontWeight="Bold"/>
                    <Grid Margin="5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <TextBlock Text="Тип распределения:" Grid.Row="0" Grid.Column="0" Margin="0,0,5,5"/>
                        <ComboBox x:Name="PointVisibleType" Grid.Row="0" Grid.Column="1" Margin="0,0,5,5" SelectedIndex="0">
                            <ComboBoxItem Content="Равномерное"/>
                            <ComboBoxItem Content="Экспоненциальное"/>
                        </ComboBox>
                        
                        <TextBlock Text="Tmax видимости:" Grid.Row="1" Grid.Column="0" Margin="0,0,5,5"/>
                        <TextBox x:Name="TmaxVisibleInput" Grid.Row="1" Grid.Column="1" Margin="0,0,0,5"/>
                        
                        <TextBlock Text="Tmax невидимости:" Grid.Row="2" Grid.Column="0" Margin="0,0,5,5"/>
                        <TextBox x:Name="TmaxInvisibleInput" Grid.Row="2" Grid.Column="1" Margin="0,0,0,5"/>
                    </Grid>
                </StackPanel>
                <StackPanel>
                    <TextBlock Text="Параметры сенсора" FontWeight="Bold"/>
                    <Grid Margin="5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <TextBlock Text="Поле зрения:" Grid.Row="0" Grid.Column="0" Margin="0,0,5,5"/>
                        <TextBox x:Name="SensorMaxDetectDist" Grid.Row="0" Grid.Column="1" Margin="0,0,0,5" Text="2"/>
                        <TextBlock Text="Тип области:" Grid.Row="1" Grid.Column="0" Margin="0,0,5,5"/>
                        <ComboBox x:Name="SensorBoundTypeComboBox" Grid.Row="1" Grid.Column="1" Margin="0,0,5,0" SelectionChanged="SensorComboBox_SelectionChanged" SelectedIndex="0">
                            <ComboBoxItem Content="Выпуклая"/>
                            <ComboBoxItem Content="Невыпуклая"/>
                            <ComboBoxItem Content="Неск. кластеров"/>
                        </ComboBox>
                    </Grid>
                    <StackPanel x:Name="ConcavePanel" Grid.Row="1" Visibility="Collapsed">
                        <Grid Margin="5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <TextBlock Text="Коефициент:" Grid.Row="0" Grid.Column="0" Margin="0,0,5,5"/>
                            <TextBox x:Name="SensorKoef" Grid.Row="0" Grid.Column="1" Margin="0,0,0,5"/>
                        </Grid>
                    </StackPanel>
                    <StackPanel x:Name="ClusterPanel" Grid.Row="1" Visibility="Collapsed">
                        <Grid Margin="5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <TextBlock Text="Макс. расстояние соседей:" Grid.Row="0" Grid.Column="0" Margin="0,0,5,5"/>
                            <TextBox x:Name="SensorClusterEps" Grid.Row="0" Grid.Column="1" Margin="0,0,0,5"/>
                            <TextBlock Text="Мин. число соседей:" Grid.Row="1" Grid.Column="0" Margin="0,0,5,5"/>
                            <TextBox x:Name="SensorClusterMinPts" Grid.Row="1" Grid.Column="1" Margin="0,0,0,5"/>
                        </Grid>
                    </StackPanel>
                    <StackPanel x:Name="ParallelPanel" Grid.Row="1">
                        <TextBlock Text="Параметры параллельного запуска" FontWeight="Bold" Margin="0,0,5,0"/>
                        <Grid Margin="5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <TextBlock Text="Количество" Grid.Column="0" Grid.Row="0" Margin="0,0,5,0"/>
                            <TextBox x:Name="ParalCount" Text="50" Grid.Column="1" Grid.Row="0" Margin="0,0,0,5"/>
                            <TextBlock Text="Скрыть окна" Grid.Column="0" Grid.Row="1" Margin="0,0,5,0"/>
                            <CheckBox x:Name="ParalVisible" Grid.Column="1" Grid.Row="1" Margin="0,0,0,5"/>
                            <TextBlock Text="Вычисление результатов" Grid.Column="0" Grid.Row="2" Margin="0,0,5,0"/>
                            <CheckBox x:Name="SensorType" Grid.Column="1" Grid.Row="2" Margin="0,0,0,5"/>
                            <TextBlock x:Name="ParallelProgressText" Text="Готово к запуску" Grid.Column="0" Grid.Row="3" Grid.ColumnSpan="2" Margin="0,5,0,5"/>
                            <ProgressBar x:Name="ParallelProgressBar" Grid.Column="0" Grid.Row="4" Grid.ColumnSpan="2" Height="16" Minimum="0" Maximum="100" Value="0"/>
                        </Grid>
                    </StackPanel>
                    
                </StackPanel>
                
            </StackPanel>

            <!-- Центральная область -->
            <Canvas x:Name="SimulationCanvas" Grid.Column="1" Background="LightGray" HorizontalAlignment="Stretch" VerticalAlignment="Stretch"/>

            <!-- Правая панель -->
            <StackPanel Grid.Column="2" Margin="5">
                <TextBlock Text="Результаты" Grid.Row="0" Grid.Column="0" FontWeight="Bold"/>
                <Grid Margin="5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Row="0" Grid.Column="0"  Text="Видимых объектов:" Margin="5"/>
                    <TextBlock Grid.Row="1" Grid.Column="0"  Text="Площадь области:" Margin="5"/>
                    <TextBlock Grid.Row="2" Grid.Column="0"  Text="Площадь ист. области:" Margin="5"/>
                    <TextBlock Grid.Row="3" Grid.Column="0"  Text="Отклонение центра:" Margin="5"/>
                    <TextBlock Grid.Row="4" Grid.Column="0"  Text="Пересечение областей:" Margin="5"/>

                    <TextBlock x:Name="PointCountText" Grid.Row="0" Grid.Column="1" Margin="5"/>
                    <TextBlock x:Name="HullAreaText" Grid.Row="1" Grid.Column="1" Margin="5"/>
                    <TextBlock x:Name="TrueHullAreaText" Grid.Row="2" Grid.Column="1" Margin="5"/>
                    <TextBlock x:Name="CenterDelayText" Grid.Row="3" Grid.Column="1" Margin="5"/>
                    <TextBlock x:Name="IntersectionText" Grid.Row="4" Grid.Column="1" Margin="5"/>
                </Grid>


                <!-- График площади -->
                <lvc:CartesianChart x:Name="AreaChart" Height="220" Margin="5" LegendLocation="Top">
                    <lvc:CartesianChart.Series>
                        <lvc:LineSeries Values="{Binding AreaValues}" StrokeThickness="2" PointGeometry="" Title = "Видимая"/>
                        <lvc:LineSeries Values="{Binding TrueAreaValues}" StrokeThickness="2" PointGeometry="" Title = "Истинная"/>
                    </lvc:CartesianChart.Series>
                    <lvc:CartesianChart.AxisX>
                        <lvc:Axis Title="Время (сек)" />
                    </lvc:CartesianChart.AxisX>
                    <lvc:CartesianChart.AxisY>
                        <lvc:Axis Title="Площадь" />
                    </lvc:CartesianChart.AxisY>
                </lvc:CartesianChart>

                <!-- График центра -->
                <lvc:CartesianChart x:Name="CenterChart" Height="220" Margin="5">
                    <lvc:CartesianChart.Series>
                        <lvc:LineSeries Values="{Binding CenterXValues}" StrokeThickness="2" Title="X" PointGeometry=""/>
                    </lvc:CartesianChart.Series>
                    <lvc:CartesianChart.AxisX>
                        <lvc:Axis Title="Время (сек)" />
                    </lvc:CartesianChart.AxisX>
                    <lvc:CartesianChart.AxisY>
                        <lvc:Axis Title="Отклонение" />
                    </lvc:CartesianChart.AxisY>
                </lvc:CartesianChart>
                
            </StackPanel>
        </Grid>
    </Grid>
</Window>
